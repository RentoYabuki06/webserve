---
title: フェーズ3: 404/403の基本応答
phase: 3
estimate: 20-30m
status: open
id: F3-04
deps: [F3-01]
---

## 目的
存在しない/拒否時に簡易HTMLで 404 / 403 を返す。

## 手順
1. パス解決後 `stat` 結果で分岐
2. 拒否条件: ディレクトリ, `..` など
3. 短い `<html><body>404 Not Found</body></html>`

## Done
`curl -i /nope` → 404。

## 補足
後でカスタムエラーページ差替え予定。

## 解説 / 背景
基本的な失敗応答が早く揃うとデバッグ時の原因追跡が容易。

## リスク / 注意点
- Content-Length 計算漏れ
- エンコード(UTF-8)統一

## テスト観点
- 不存在パス
- ディレクトリ/拒否ケース

## 受入チェックリスト
- [ ] 404本文
- [ ] 403本文
- [ ] ヘッダ整合

## 簡易コード例
```cpp
std::string errorPage(int code) {
	std::string msg = (code==404?"Not Found": code==403?"Forbidden":"Error");
	std::ostringstream oss;
	std::string body = "<html><body><h1>" + toString(code) + " " + msg + "</h1></body></html>";
	oss << "HTTP/1.1 " << code << ' ' << msg << "\r\n";
	oss << "Content-Length: " << body.size() << "\r\nContent-Type: text/html\r\nConnection: close\r\n\r\n" << body;
	return oss.str();
}
```

